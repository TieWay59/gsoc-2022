# Coding Period 1 week-03

## Insight of Gitee data source

What it will be looked like: a running instance of the Grimoirelab with ElasticSearch retriving data from the Gitee web site.

## SirMorded 文件结构注释

```bash
# this is generated by the `tree` command.
.
├── bin
│ └── sirmordred.py # One of the run entries, handling only arguments (-c -t -p), calls `from sirmordred.sirmordred import SirMordred` in the root directory. Included in `pyproject.toml - [tool.poetry.scripts]`
├── config.py # Contains the important `setup.cfg` configuration profile, and methods for creating and reading configuration files
├── error.py
├── github.py # Provides a way to crawl GitHub for files
├── __init__.py
├── __pycache__ # store the bytecode compiled by the interpreter
│ ├── config.cpython-310.pyc
│ └── ...
├── sirmordred.py # The main class of the program, the methods mainly call all subsequent tasks
├── task_collection.py #
├── task_enrich.py #
├── task_identities.py #
├─ task_manager.py #
├─ task_panels.py #
├─ task_projects.py #
├── task.py # Parent of all tasks
├─ utils
│ ├── find_affiliation_conflicts.py # Standalone script for finding conflicts in organizations to which they belong
│ ├── grimoirelab_valid.yml # yml data for unknown purposes
│ ├── healthcheck.py # Standalone script that provides a way to query the log for error reporting information. Contained in `pyproject.toml - [tool.poetry.scripts]`
│ ├── micro.py # is a test-friendly scripting program. As opposed to sirmordred.py, which executes the project in its entirety, micro.py can be parameterized to determine only which tasks are executed for testing purposes. Included in `pyproject.toml - [tool.poetry.scripts]`
│ ├── panels_config.py # This script allows uploading setup.cfg and the dashboards used in the top menu. It depends on the task panel and the task panel menu class. Look at the main function to see what the movement is doing. Included in `pyproject.toml - [tool.poetry.scripts]`
│ ├── projects.json
│ ├── projects_json2yml.py # Convert JSON to YML: return hierarchy.yml and projects_repo.yml don't know what to do
│ └── setup.cfg #
└── _version.py
```

## setup.cfg file

To understand what configuration items are in this file, you can read the code: `grimoirelab-sirmordred/sirmordred/config.py` (Edit: I realized later that `grimoirelab-sirmordred/README.md` is very clear)

In particular, the back end is described in great detail.

The configuration options are set via the INI file, which has several sections, such as `[gitlab]`, called the basic backend section, and sections such as `[gitlab:issue]` or `[gitlab:ieee]`, called the parameterized backend section.

## Pycharm PYTHONPATH problem

[python 3.x - Able to start module in terminal but not with PyCharm's run config - Stack Overflow](https://stackoverflow.com/questions/70555130/able-to-start-module-in-terminal-but-not-with-pycharms-run-config)

These two options of Pycharm run Configuration may cause the module to fail to be read.

- [ ] Add content roots to PYTHONPATH
- [ ] Add source roots to PYTHONPATH

> PYTHONPATH is an environment variable that you can set to add additional directories in which python will look for modules and packages. For most installations, you should not set these variables, as Python does not need them to run. python knows where to find its standard libraries. The only reason to set PYTHONPATH is to maintain directories for custom Python libraries that you don't want installed in the global default location (i.e., the site packages directory).

## Trying to install Gitee

The packages that sirmordred depends on are actually installed directly into the virtual environment for invocation, one way using `requirements.txt` and the other using `poetry & pyproject.toml`. However, I was under the impression that I may have installed both ways by mistake, leading to some unidentifiable errors.

The initial tutorial asked me to download all a dozen repositories, but it's still not clear how the association was established, since it automatically maps `grimoirelab_elk` to the locally cloned repository.

My understanding is that at some point, these cloned local repositories are actually installed into the environment.

The following way to install gitee is not too complicated, just pull in the corresponding repository dependencies and then pull in the configuration files. From the steps, it seems that I prefer to compile and run the project directly with sirmordred proper. I need to pull a few project configuration files into the directory where sirmordred is located.

[How to run grimoirelab gitee? · grimoirelab-gitee/grimoirelab Wiki](https://github.com/grimoirelab-gitee/grimoirelab/wiki/How-to-run-grimoirelab-gitee%3F)

According to this documentation, simply install (or replace) the following modules in an existing vlen.

```BASH
perceval-gitee      0.1.0     /root/repos/grimoirelab-perceval-gitee
grimoire-elk        0.86.0    /root/repos_grimoirelab/grimoireelk
grimoire-elk-gitee  0.1.0     /root/repos_grimoirelab/grimoirelab-elk-gitee
grimoirelab-panels  0.0.60    /root/repos_grimoirelab/sigils
```

Where grimoire-elk & grimoirelab-panels are to be done as uninstall replacements.

I found that grimoire-elk & grimoirelab-panels are not available in the current version, and combined with my previous mistake, I'm sure it's a problem with the environment installation. At this point I realized that my direct run was not working, so the best solution was to reinstall the environment.

Next week I will document in detail how I reinstalled the environment and integrated it into the gitee datasource.
